{"version":3,"file":"main.a8912545a3e3ceb26763.hot-update.js","mappings":"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","sources":["webpack://sun/./src/lib/dom.ts","webpack://sun/./src/main.ts","webpack://sun/./src/utils/utils.ts","webpack://sun/webpack/runtime/getFullHash"],"sourcesContent":["import { TFiber } from 'types/fiber.type'\r\nimport { NODE_TYPE } from '../config/config'\r\nimport { isProperty, isOld, isNewly, isSystemEvent } from '../utils/utils'\r\n\r\n/**\r\n * 追加 DOM\r\n * @param {object} childDom 被追加的子节点\r\n * @param {object} parentDom 目标父节点\r\n * @return {htmlelement} 元素 HTMLElement 对象\r\n */\r\nexport function commitAppendChild(childDom: HTMLElement, parentDom: HTMLElement) {\r\n\tparentDom.appendChild(childDom)\r\n}\r\n\r\n/**\r\n * 移除 DOM\r\n * @param {object} fiber fiber 节点对象\r\n * @param {object} parentDom 目标父节点\r\n * @return {htmlelement} 元素 HTMLElement 对象\r\n */\r\nexport function commitDeleteChild(fiber: TFiber, parentDom: HTMLElement) {\r\n\tif (fiber.stateNode) {\r\n\t\tparentDom.removeChild(fiber.stateNode)\r\n\t} else {\r\n\t\t// commitDeletion(fiber.child, parentDom)\r\n\t}\r\n}\r\n\r\n/**\r\n * 创建 标准 DOM 对象\r\n * @param {object} fiber fiber 节点对象\r\n * @return {htmlelement} 元素 HTMLElement 对象\r\n */\r\nexport function createDOM(fiber: TFiber) {\r\n\tconst dom = fiber.type === NODE_TYPE.TEXT_NODE ? document.createTextNode(``) : document.createElement(fiber.type)\r\n\tupdateDOM(dom, {}, fiber.props)\r\n\treturn dom\r\n}\r\n\r\n/**\r\n * 更新 DOM\r\n * @param {object} dom HTMLElement 节点对象\r\n * @param {object} oldProps Props 属性对象\r\n * @param {object} newProps Props 属性对象\r\n * @return {htmlelement} 元素 DOM 对象\r\n */\r\nexport function updateDOM(dom: HTMLElement, oldProps: { [key: string]: any }, newProps: { [key: string]: any }) {\r\n\tconst systemEventOfOldProps = Object.keys(oldProps).filter(isSystemEvent)\r\n\tconst systemEventOfNewProps = Object.keys(newProps).filter(isSystemEvent)\r\n\tconst commPropsOfOldProps = Object.keys(oldProps).filter(isProperty)\r\n\tconst commPropsOfNewProps = Object.keys(newProps).filter(isProperty)\r\n\r\n\t/*\r\n\t\t系统事件处理 - 移除 \r\n\t */\r\n\tfor (let i = 0; i < systemEventOfOldProps.length; i++) {\r\n\t\tconst item = systemEventOfOldProps[i]\r\n\t\tif (!(item in newProps) || isNewly(oldProps, newProps)(item)) {\r\n\t\t\tconst eventType = item.toLowerCase().substring(2)\r\n\t\t\tdom.removeEventListener(eventType, oldProps[item])\r\n\t\t}\r\n\t}\r\n\t/* \r\n\t\t删除旧属性\r\n\t */\r\n\tfor (let i = 0; i < commPropsOfOldProps.length; i++) {\r\n\t\tconst item = commPropsOfOldProps[i]\r\n\t\tif (isOld(oldProps, newProps)(item)) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tdom[item] = undefined\r\n\t\t\tif (dom.removeAttribute) {\r\n\t\t\t\tdom.removeAttribute(item)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t\t更新或写入新属性 \r\n\t */\r\n\tfor (let i = 0; i < commPropsOfNewProps.length; i++) {\r\n\t\tconst item = commPropsOfNewProps[i]\r\n\t\tif (isNewly(oldProps, newProps)(item)) {\r\n\t\t\tswitch (item) {\r\n\t\t\t\tcase 'style': {\r\n\t\t\t\t\tif (Object.prototype.toString.call(newProps[item]).toLowerCase() === '[object object]') {\r\n\t\t\t\t\t\tfor (let attr in newProps[item]) {\r\n\t\t\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\t\t\tdom.style[attr] = newProps[item][attr]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tdom[item] = newProps[item]\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tcase 'className': {\r\n\t\t\t\t\tdom[item] = newProps[item]\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tdom[item] = newProps[item]\r\n\t\t\t\t\tif (dom.setAttribute && typeof newProps[item] != 'undefined') {\r\n\t\t\t\t\t\tdom.setAttribute(item, newProps[item])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t\t系统事件处理 - 设置\r\n\t */\r\n\tfor (let i = 0; i < systemEventOfNewProps.length; i++) {\r\n\t\tconst item = systemEventOfNewProps[i]\r\n\t\tif (isNewly(oldProps, newProps)(item)) {\r\n\t\t\tconst eventType = item.toLowerCase().substring(2)\r\n\t\t\tdom.addEventListener(eventType, newProps[item])\r\n\t\t}\r\n\t}\r\n}\r\n","import { NODE_TYPE } from './config/config'\r\nimport { __RUNTIME_PROFILE___ } from './runtime/runtime.profile'\r\nimport { initWorkLoop } from './lib/scheduler'\r\nimport { generateStructFiber, generateStructVDOM, generateStructFiberRoot } from './utils/utils'\r\n\r\n/* \r\n\t创建一个全局的 fiberRoot\r\n\t并设置其 current 指针指向当前活动(即 处于 mount 或 update 时)的应用的顶层 fiber\r\n */\r\n__RUNTIME_PROFILE___.fiberRoot = generateStructFiberRoot({\r\n\tcurrent: null,\r\n})\r\n\r\n/**\r\n * 创建 元素 VDOM\r\n * @param {string} type 元素标签名\r\n * @param {object} props 属性对象\r\n * @param {any} children 子节点列表\r\n * @return {htmlelement} 元素 VDOM\r\n */\r\nexport function createElement(type: any, props: { [key: string]: any }, ...children: any[]) {\r\n\t//@ts-ignore\r\n\tconst flatChildren = children.flat(Infinity) // or children.flat(1)\r\n\treturn generateStructVDOM(type, {\r\n\t\t...props,\r\n\t\tchildren: flatChildren.map((child: any) => {\r\n\t\t\treturn typeof child === 'object' ? child : createTextElement(child)\r\n\t\t}),\r\n\t})\r\n}\r\n\r\n/**\r\n * 创建 文本 VDOM\r\n * @param {string} text 文本内容\r\n * @return {htmlelement} 文本 VDOM\r\n */\r\nexport function createTextElement(text: string) {\r\n\treturn generateStructVDOM(NODE_TYPE.TEXT_NODE, {\r\n\t\tnodeValue: text,\r\n\t\tchildren: [],\r\n\t})\r\n}\r\n\r\nlet renderIndex = -1\r\nexport function render(element: any, container: HTMLElement) {\r\n\tconst rootFiber = generateStructFiber(\r\n\t\t{\r\n\t\t\tstateNode: container,\r\n\t\t\ttype: container.nodeName.toLowerCase(),\r\n\t\t\tprops: { children: [element] },\r\n\t\t\talternate: null,\r\n\t\t\tdirty: true,\r\n\t\t},\r\n\t\t{\r\n\t\t\t/*\r\n\t\t\t\t当前 fiber 的索引编号, 保证值与该 fiber 在 fiber-list 中的位置索引一致 \r\n\t\t\t */\r\n\t\t\tindex: ++renderIndex,\r\n\t\t\troot: true,\r\n\t\t}\r\n\t)\r\n\t__RUNTIME_PROFILE___.rootFiberList.push(rootFiber)\r\n\tif (!__RUNTIME_PROFILE___.fiberRoot.current) {\r\n\t\t__RUNTIME_PROFILE___.fiberRoot.current = rootFiber\r\n\t\t__RUNTIME_PROFILE___.nextWorkUnitFiber = rootFiber\r\n\t\tconsole.log(`Root.Fiber ===>>>`, rootFiber)\r\n\t\twindow.requestIdleCallback(initWorkLoop())\r\n\t}\r\n}\r\n","import { TFiber } from 'types/fiber.type'\r\nimport { RECONCILE_EFFECT_TYPE } from '../config/config'\r\n\r\nexport function generateStructVDOM(type: string, props: { [key: string]: any }) {\r\n\treturn {\r\n\t\ttype,\r\n\t\tprops,\r\n\t}\r\n}\r\n\r\n/*\r\n\troot = {\r\n\t\troot: boolean\r\n\t}\r\n */\r\nexport function generateStructFiber(args: { [key: string]: any } = {}, root: { [key: string]: any } = {}) {\r\n\tconst defaults = {\r\n\t\t/* \r\n\t\t\tVDOM 属性/fiber 链表节点属性 \r\n\t\t*/\r\n\t\t/* \r\n\t\t\tFunctionComponent = 函数本身\r\n\t\t\tClassComponent = class\r\n\t\t\tHostComponent = DOM节点 tagName \r\n\t\t*/\r\n\t\ttype: null,\r\n\t\telementType: null,\r\n\t\tstateNode: null,\r\n\t\tprops: null,\r\n\t\tchild: null,\r\n\t\tparent: null,\r\n\t\tsibling: null,\r\n\t\talternate: null,\r\n\t\teffectTag: RECONCILE_EFFECT_TYPE.NO_EFFECT,\r\n\t\tkey: null,\r\n\t\tdirty: false,\r\n\t\t/* \r\n\t\t\thooks \r\n\t\t*/\r\n\t\thooks: [],\r\n\t}\r\n\treturn {\r\n\t\t...defaults,\r\n\t\t...args,\r\n\t\t...root,\r\n\t}\r\n}\r\n\r\nexport function generateStructFiberRoot(args: { [key: string]: any } = {}) {\r\n\tconst defaults = {\r\n\t\tcurrent: null,\r\n\t}\r\n\treturn {\r\n\t\t...defaults,\r\n\t\t...args,\r\n\t}\r\n}\r\n\r\nexport function getRootFiber(fiber: TFiber) {\r\n\tlet rootFiber = fiber\r\n\twhile (!rootFiber.root) {\r\n\t\trootFiber = rootFiber.parent\r\n\t}\r\n\treturn rootFiber\r\n}\r\n\r\nexport function isNewly(oldObj: { [key: string]: any }, newObj: { [key: string]: any }) {\r\n\treturn (key: string) => {\r\n\t\treturn oldObj[key] !== newObj[key]\r\n\t}\r\n}\r\n\r\nexport function isOld(oldObj: { [key: string]: any }, newObj: { [key: string]: any }) {\r\n\treturn (key: string) => {\r\n\t\treturn !(key in newObj)\r\n\t}\r\n}\r\n\r\nexport function isProperty(key: string) {\r\n\treturn !['children'].includes(key) && !(key[0] === 'o' && key[1] === 'n')\r\n}\r\n\r\nexport function isSystemEvent(key: string) {\r\n\treturn key[0] === 'o' && key[1] === 'n'\r\n}\r\n\r\nexport function isApprovedComponent(fiber: TFiber) {\r\n\treturn fiber.type != null || typeof fiber.type != 'undefined'\r\n}\r\n\r\nexport function isFunctionComponent(fiber: TFiber) {\r\n\treturn fiber && fiber.type && fiber.type instanceof Function\r\n}\r\n\r\nexport function syncBlock(delay = 1000) {\r\n\tconst end = new Date().getTime() + delay\r\n\twhile (new Date().getTime() < end) {}\r\n}\r\n","__webpack_require__.h = () => (\"99dd50b8ccb8f9e9162a\")"],"names":[],"sourceRoot":""}